(function(a){'use strict';function b(x){return class extends x{constructor(){super();let y=new.target.model;this.model=b.model(y?y():{});let z=new.target.template;z&&(this._hydrate=b.template(z())),this._hasRendered=!1}connectedCallback(){if(this._hydrate&&!this._hasRendered){let y=this._hydrate(this.model);// TODO determine where to render
this.attachShadow({mode:'open'}),this.shadowRoot.appendChild(y)}}}}function c(x,y,z){var A=y.compute(x),B=function(){z(A())};y.props().forEach(function(C){var D=x.read(C),E=D.model;!1!==D.bindable&&b.addEventListener(E,C,B)}),B()}function d(){this.values={},this.raw='',this.hasBinding=!1,this.includesNonBindings=!1}function e(x){for(var E,y=0,z=x.length,A=new d,B=!1,C='',D=0;y<z;){if(C=E,E=x[y],!B){if('{'===E){'{'==C&&(A.hasBinding=!0,D=A.raw.length,null!=A.values[D]&&D++,A.values[D]='',B=!0),y++;continue}A.raw+=E}else{if('}'===E){'}'==C&&(B=!1),y++;continue}A.values[D]+=E}y++}return A.includesNonBindings=0<A.raw.length,A}function f(x,y,z){var A={};switch(x.nodeType){// Element
case 1:var B;if('TEMPLATE'===x.nodeName&&(B=g(x))){var C=e(x.getAttribute(B));C.hasBinding&&(C.throwIfMultiple(),A[B]=!0,z[y.id]=function(E,F){'each'===B?u.each(E,F,C,E):c(F,C,u[B](E,F))})}break;// TextNode
case 3:var C=e(x.nodeValue);C.hasBinding&&(z[y.id]=function(E,F){c(F,C,u.text(E))});}q.call(x.attributes||[],function(E){if(y.id++,!A[E.name]){var F=E.name,G=h(F),H=e(E.value);H.hasBinding?z[y.id]=function(K,L){return G?(K.removeAttribute(F),void c(L,H,u.prop(K,F.substr(1)))):void c(L,H,u.attr(K,F))}:G&&console.log('still do this')}});var D=x.childNodes;return q.call(D,function(E){y.id++,f(E,y,z)}),z}function g(x){var y;for(var z=0,A=v.length;z<A;z++)if(y=v[z],x.getAttribute(y))return y}function h(x){return x&&':'===x[0]}function j(x,y,z){function A(F){if(E++,D===E){var G=y[D];G(F,z),D=+C.shift()}return!D}function B(F){var G;return(r.call(F.attributes||[],function(){if(G=A(F),G)return!0}),!G)&&(r.call(F.childNodes,function(H){return(G=A(H),!!G)||(G=!B(H),!!G)||void 0}),!G)}var C=Object.keys(y),D=+C.shift(),E=0;B(x)}function k(x,y){this.model=x,this.parent=y}function l(x,y){return Array.isArray(x)&&!isNaN(+y)}function m(x){return Array.isArray(x)||'object'==typeof x}function n(x,y){return new Proxy(x,{set:function(z,A,B){var C=z[A];// If the value hasn't changed, nothing else to do
return(!b.isModel(B)&&m(B)&&(B=b.model(B)),z[A]=B,B===C)||(l(z,A)?y({prop:b.arrayChange,index:+A,type:'set'},B):y({prop:A,type:'set'},B),!0)},deleteProperty:function(z,A){return l(z,A)&&y({prop:b.arrayChange,index:+A,type:'delete'}),!0}})}function p(x){var y;if(Array.isArray(x))y=s.call(x);else if(x)var z=Object.getPrototypeOf(x),y=Object.create(z);return x?Object.keys(x).reduce(function(A,B){var C=x[B];return A[B]=Array.isArray(C)||'object'==typeof C?b.model(C):C,A},y):x}b.Element=b(HTMLElement);var q=Array.prototype.forEach,r=Array.prototype.some,s=Array.prototype.slice;if(b.values=Object.values||function(x){return Object.keys(x).reduce(function(y,z){return y.push(x[z]),y},[])},b.template=function(x){x=x instanceof HTMLTemplateElement?x:document.querySelector(x);var y=f(x.content,{id:0},{});return function(z){z instanceof k||(z=new k(z));var A=document.importNode(x.content,!0);return j(A,y,z),A}},b.symbol='function'==typeof Symbol?Symbol:function(x){return'@@-'+x},'object'==typeof module&&module.exports?module.exports=b:window.Bram=b,'function'!=typeof Map){function x(z){var A=typeof z;if('string'==A||'number'==A)return z;var B=z[t];return B||Object.defineProperty(z,t,{value:B++,enumerable:!1,writable:!1,configurable:!1}),B}function y(){this.k={}}var t=b.symbol('bid');y.prototype.set=function(z,A){var B=x(obj);this.k[B]=A},y.prototype.get=function(z){return this.k[x(z)]},y.prototype.delete=function(z){delete this.k[x(z)]}}var u={attr:function(x,y){return function(z){x.setAttribute(y,z)}},text:function(x){return function(y){x.nodeValue=y}},prop:function(x,y){return function(z){x[y]=z}},each:function(x,y,z){var A=b.template(x),B=z.props()[0],C=y.read(B),D=document.createTextNode('');x.parentNode.replaceChild(D,x);var E=function(G){var H=new Map,I=new Map,J=function(M,N){var O=y.add(M).add({item:M,index:N}),P=A(O),Q={item:M,nodes:s.call(P.childNodes),scope:O,index:N};H.set(M,Q),I.set(N,Q);var R=I.get(N+1),S=D.parentNode;if(R){var T=R.nodes[0];S.insertBefore(P,T)}else S.appendChild(P)},K=function(M){var N=I.get(M);N&&(N.nodes.forEach(function(O){O.parentNode.removeChild(O)}),H.delete(N.item),I.delete(M))};G.forEach(J);var L=function(M,N){if('delete'===M.type)return void K(M.index);var O=H.get(N);if(O){var P=O.index,Q=P!==M.index;if(Q){O.scope.model.index=O.index=M.index;var R=I.get(M.index);R?I.set(P,R):I.delete(P),I.set(M.index,O);var S=I.get(M.index+1);S&&(S=S.nodes[0]);for(var T=O.nodes.length-1;0<=T;)D.parentNode.insertBefore(O.nodes[T],S),T--}}else K(M.index),J(N,M.index)};return b.addEventListener(G,b.arrayChange,L),function(){for(var M=0,N=G.length;M<N;M++)K(M);b.removeEventListener(G,b.arrayChange,L),H=null,I=null}},F=E(C.value);b.addEventListener(C.model,B,function(G,H){F(),F=E(H)})},if:function(x,y){var z=b.template(x),A=!1,B={},C=document.createTextNode('');return x.parentNode.replaceChild(C,x),function(D){if(!!A){var G=C.parentNode,H=C.nextSibling;D?B.children.forEach(function(I){G.insertBefore(I,H)}):B.children.forEach(function(I){G.removeChild(I)})}else if(D){var E=y.add(D),F=z(E);B.children=s.call(F.childNodes),B.scope=E,C.parentNode.insertBefore(F,C.nextSibling),A=!0}}}};d.prototype.getValue=function(x){var y=this.props()[0];return x.read(y).value},d.prototype.getStringValue=function(x){for(var A,B,y=Object.keys(this.values).sort(),z=this.raw;y.length;)A=y.pop(),B=x.read(this.values[A]).value,z=B?z.substr(0,A)+B+z.substr(A):a;return z},d.prototype.compute=function(x){var y=this.includesNonBindings||1<this.count();return y?this.getStringValue.bind(this,x):this.getValue.bind(this,x)},d.prototype.props=function(){return b.values(this.values)},d.prototype.count=function(){return!1===this.hasBinding?0:Object.keys(this.values).length},d.prototype.throwIfMultiple=function(x){if(1<this.count())throw x=x||'Only a single binding is allowed in this context.',new Error(x)},b.parse=e;var v=['if','each'];b.Scope=k,k.prototype.read=function(x){return this._read(x)||{model:this.model,value:a}},k.prototype._read=function(x){var y=this.model[x];return null==y?this.parent?this.parent.read(x):void 0:{model:this.model,value:y}},k.prototype.add=function(x){var y;return y=b.isModel(x)?x:Array.isArray(x)||'object'==typeof x?b.model(x):x,new k(y,this)};var w=b.symbol('bram-events');b.arrayChange=b.symbol('bram-array-change'),b.model=function(x){return x=p(x)||{},Object.defineProperty(x,w,{value:{},enumerable:!1}),n(x,function(y,z){var A=x[w][y.prop];A&&A.forEach(function(B){B(y,z)})})},b.isModel=function(x){return x&&!!x[w]},b.addEventListener=function(x,y,z){var A=x[w];if(A){var B=A[y];B||(B=A[y]=[]),B.push(z)}},b.removeEventListener=function(x,y,z){var A=x[w];if(A){var B=A[y];if(B){var C=B.indexOf(z);-1===C||(B.splice(C,1),!B.length&&delete A[y])}}},b.off=function(x){x[w]={},Object.keys(x).forEach(function(y){var z=x[y];(Array.isArray(z)||'object'==typeof z)&&b.off(z)})},b.onChildren=function(x,y){var z=!1,A=function(){z||y(x.childNodes)},B=new MutationObserver(A);return B.observe(x,{childList:!0}),x.childNodes.length&&Promise.resolve().then(A),function(){z=!0,B.disconnect()}}})();

