<!doctype html>
<html>
<head>
  <title>elements tests</title>

  <script src="../node_modules/webcomponents.js/webcomponents-lite.min.js"></script>
  <link rel="import" href="../node_modules/mocha-test/mocha-test.html">
  <script src="../bram.js"></script>
</head>
<body>
  <template id="someTemplate">
    <span>{{hello}}</span>
  </template>
  <template id="clickTemplate">
    <a href="#" on-click="doSomething">Click me</a>
  </template>
  <some-element id="someElement"></some-element>
  <light-element id="lightElement"></light-element>
  <click-element id="clickElement"></click-element>
  <evented-element id="eventedElement"></evented-element>
<div id="host"></div>
<mocha-test>
<template>
  <script>
    describe("Bram.element", function(){
      before(function(){
        class SomeElement extends Bram.Element {
          static template() {
            return "#someTemplate";
          }

          constructor() {
            super();
            this.hello = 'world';
          }
        }

        customElements.define('some-element', SomeElement);
      });

      it("Renders to shadowRoot", function(){
        let root = someElement.shadowRoot;
        let txt = root.firstElementChild.textContent;

        assert.equal(txt, 'world');
      });

      describe('renderMode', function(){
        before(function(){
          class LightElement extends Bram.Element {
            static template() {
              return "#someTemplate";
            }
            static get renderMode() {
              return 'light';
            }
            constructor() {
              super();
              this.hello = 'worked';
            }
          }

          customElements.define('light-element', LightElement);
        });

        it('"light" renders to the element\'s light DOM', function(){
          let root = lightElement;
          let txt = root.firstElementChild.textContent;

          assert.equal(txt, 'worked');
        });
      });

      describe('Declarative Events', function(){
        it('Clicks work', function(){
          class ClickElement extends Bram.Element {
            static template() {
              return clickTemplate;
            }

            constructor() {
              super();
              this.clicks = 0;
            }

            doSomething(ev) {
              this.clicks++;
              ev.preventDefault();
            }
          }

          customElements.define('click-element', ClickElement);

          var clickElement = document.querySelector('click-element');
          var el = clickElement.shadowRoot.querySelector('a');
          el.dispatchEvent(new Event('click'));

          assert.equal(clickElement.clicks, 1);
        });
      });

      describe('Event properties', function(){
        before(function(){
          class EventedElement extends Bram.Element {
            static events() {
              return ['foo'];
            }

            trigger() {
              this.dispatchEvent(new Event('foo'));
            }
          }
          customElements.define('evented-element', EventedElement);
        });

        it('Are added to instances', function(done){
          eventedElement.onfoo = function(){
            assert.ok(true, 'this was called');
            done();
          };
          eventedElement.trigger();
        });
      });
    });
  </script>
</template>
</mocha-test>
</body>
</html>
