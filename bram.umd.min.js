(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b(require('@matthewp/template-instantiation')):'function'==typeof define&&define.amd?define(['@matthewp/template-instantiation'],b):a.Bram=b(a.createInstance)})(this,function(a){'use strict';function b(y,z){return Array.isArray(y)&&!isNaN(+z)}function c(y){return Array.isArray(y)||'object'==typeof y}function d(y,z){var A=new Proxy(y,{get:function(B,C){return n.observe(A,C),B[C]},set:function(B,C,D){var E=B[C];// If the value hasn't changed, nothing else to do
return!(!s(D)&&c(D)&&(D=r(D)),B[C]=D,D!==E)||(b(B,C)?z({prop:q,index:+C,type:'set'},D):z({prop:C,type:'set'},D),!0)},deleteProperty:function(B,C){return b(B,C)&&z({prop:q,index:+C,type:'delete'}),!0}});return A}function e(y){return y?Object.keys(y).reduce(function(z,A){var B=y[A];return z[A]=Array.isArray(B)||'object'==typeof B?r(B):B,z},y):y}function f(y){let z='string'==typeof y?document.querySelector(y):y;return function(A){let B=A;A instanceof u||(B=new u(A));let C=new v;return k(z,C,B)}}function g(y){return class extends y{constructor(){super();var z=this.constructor;this._hasRendered=!1,this.model={},this._hydrate=z.template&&f(z.template);let A=z.events;A&&!z._hasSetupEvents&&h(z);let B=!z._hasInstalledProps&&z.observedProperties;B&&(z._hasInstalledProps=!0,i(z,B,z.observedAttributes))}connectedCallback(){if(this._hydrate&&!this._hasRendered){s(this.model)||(this.model=r(this.model));let z=new u(this).add(this.model);this._template=this._hydrate(z);let A=this.constructor.renderMode;'light'===A?(this.innerHTML='',this.appendChild(this._template)):(this.attachShadow({mode:'open'}),this.shadowRoot.appendChild(this._template)),this._hasRendered=!0}this.childrenConnectedCallback&&(this._disconnectChildMO=j(this))}disconnectedCallback(){this._disconnectChildMO&&this._disconnectChildMO(),this._link&&this._link.detach()}attributeChangedCallback(z,A,B){var C=this.constructor._syncedAttrs,D=C&&C[z];D&&this[z]!==B&&(this[z]=B)}}}function h(y){y._hasSetupEvents=!0,y.events.forEach(function(z){Object.defineProperty(y.prototype,'on'+z,{get:function(){return this['_on'+z]},set:function(A){var B='_on'+z,C=this[B];C&&this.removeEventListener(z,C),this[B]=A,this.addEventListener(z,A)}})})}function i(y,z,A=[]){y._syncedAttrs={};var B=y.prototype;z.forEach(function(C){var D=Object.getOwnPropertyDescriptor(B,C);if(!D){var E=-1!==A.indexOf(C);E&&(y._syncedAttrs[C]=!0),Object.defineProperty(B,C,{get:function(){return this.model[C]},set:function(F){if(this.model[C]=F,E){var G=this.getAttribute(C);'boolean'==typeof F?F&&''!==G?this.setAttribute(C,''):''===G&&!F&&this.removeAttribute(C):G!==F&&this.setAttribute(C,F)}}})}})}function j(y){var z=!1,A=function(){z||y.childrenConnectedCallback()};if(!x)return void m(A);var B=new MutationObserver(A);return B.observe(y,{childList:!0}),y.childNodes.length&&m(A),function(){z=!0,B.disconnect()}}var k='default'in a?a['default']:a,l='function'==typeof Symbol?Symbol:function(y){return'@@-'+y},m='function'==typeof Promise?y=>Promise.resolve().then(y):y=>setTimeout(()=>y(),0);class n{static add(y){this.current=y,this.stack.push(y)}static remove(){this.stack.pop(),this.current=this.stack[this.stack.length-1]}static observe(y,z){this.current&&this.current.stack.push([y,z])}constructor(){this.stack=[]}start(){n.add(this)}stop(){return n.remove(),this.stack}}n.stack=[];var p=l('bram-events'),q=l('bram-array-change'),r=function(y,z){return s(y)?y:(y=e(y,z)||{},Object.defineProperty(y,p,{value:{},enumerable:!1}),d(y,function(A,B){var C=y[p][A.prop];C&&C.forEach(function(D){D(A,B)})}))},s=function(y){return y&&!!y[p]};class u{constructor(y,z){this.model=y,this.parent=z}read(y){return this._read(y)||{model:this.model,value:void 0}}readInTransaction(y){var z=new n;z.start();var A=this.read(y);return A.reads=z.stop(),A}_read(y){var z=this.model,A=z[y];if(null==A){// Handle dotted bindings like "user.name"
var B=y.split('.');if(1<B.length)do A=z[B.shift()],B.length&&(z=A);while(B.length&&A)}return null==A?this.parent?this.parent.read(y):void 0:{model:z,value:A}}add(y){var z;return z=s(y)?y:Array.isArray(y)||'object'==typeof y?r(y):y,new u(z,this)}}class v extends a.TemplateProcessor{createdCallback(){}processCallback(y,z){for(const A of y)if(A instanceof a.InnerTemplatePart);else if(A instanceof a.NodeTemplatePart){const{expression:B}=A.rule;A.value=z&&B&&z[B]}else if(A instanceof a.AttributeTemplatePart){const{expressions:B}=A.rule;A.value=z&&B&&B.map(C=>z&&z[C])}}}var w=g(HTMLElement);g.Element=w,g.model=r,g.on=function(y,z,A){var B=y[p];if(B){var C=B[z];C||(C=B[z]=[]),C.push(A)}},g.off=function(y,z,A){var B=y[p];if(B){var C=B[z];if(C){var D=C.indexOf(A);-1===D||(C.splice(D,1),!C.length&&delete B[z])}}},g.template=f;var x='function'==typeof MutationObserver;return g});

