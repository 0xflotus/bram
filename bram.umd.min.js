(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.Bram=b()})(this,function(){'use strict';function a(F,G){return Array.isArray(F)&&!isNaN(+G)}function b(F){return Array.isArray(F)||'object'==typeof F}function c(F,G){return new Proxy(F,{set:function(H,I,J){var K=H[I];// If the value hasn't changed, nothing else to do
return(!y(J)&&b(J)&&(J=x(J)),H[I]=J,J===K)||(a(H,I)?G({prop:w,index:+I,type:'set'},J):G({prop:I,type:'set'},J),!0)},deleteProperty:function(H,I){return a(H,I)&&G({prop:w,index:+I,type:'delete'}),!0}})}function d(F){return F?Object.keys(F).reduce(function(G,H){var I=F[H];return G[H]=Array.isArray(I)||'object'==typeof I?x(I):I,G},F):F}function e(F,G){this.model=F,this.parent=G}function f(F,G,H){function I(N){if(M++,L===M){var O=G[L];O(N,H),L=+K.shift()}return!L}function J(N){var O;return(t.call(N.attributes||[],function(){if(O=I(N),O)return!0}),!O)&&(t.call(N.childNodes,function(P){return(O=I(P),!!O)||(O=!J(P),!!O)||void 0}),!O)}var K=Object.keys(G),L=+K.shift(),M=0;J(F)}function g(){this.values={},this.raw='',this.hasBinding=!1,this.includesNonBindings=!1}function h(F){for(var M,G=0,H=F.length,I=new g,J=!1,K='',L=0;G<H;){if(K=M,M=F[G],!J){if('{'===M){'{'==K&&(I.hasBinding=!0,L=I.raw.length,null!=I.values[L]&&L++,I.values[L]='',J=!0),G++;continue}I.raw+=M}else{if('}'===M){'}'==K&&(J=!1),G++;continue}I.values[L]+=M}G++}return I.includesNonBindings=0<I.raw.length,I}function j(F,G,H){var I=G.compute(F),J=function(){H(I())};G.props().forEach(function(K){var L=F.read(K),M=L.model;!1!==L.bindable&&z(M,K,J)}),J()}function k(F,G,H){var I={};switch(F.nodeType){// Element
case 1:var J;if('TEMPLATE'===F.nodeName&&(J=l(F))){var K=h(F.getAttribute(J));K.hasBinding&&(K.throwIfMultiple(),I[J]=!0,H[G.id]=function(M,N){'each'===J?B.each(M,N,K,M):j(N,K,B[J](M,N))})}break;// TextNode
case 3:var K=h(F.nodeValue);K.hasBinding&&(H[G.id]=function(M,N){j(N,K,B.text(M))});}s.call(F.attributes||[],function(M){if(G.id++,!I[M.name]){var N=M.name,O=m(N),P=h(M.value);if(P.hasBinding)H[G.id]=function(T,U){return O?(T.removeAttribute(N),void j(U,P,B.prop(T,N.substr(1)))):void j(U,P,B.attr(T,N))};else if(O);else if('on-'===N.substr(0,3)){var Q=N.substr(3);H[G.id]=function(T,U){T.removeAttribute(N),B.event(T,Q,U,P)}}}});var L=F.childNodes;return s.call(L,function(M){G.id++,k(M,G,H)}),H}function l(F){var G;for(var H=0,I=C.length;H<I;H++)if(G=C[H],F.getAttribute(G))return G}function m(F){return F&&':'===F[0]}function n(F){return class extends F{constructor(){super();var G=this.constructor;let H=G.template;H&&(this._hydrate=D(H())),this._hasRendered=!1;let I=G.events;I&&!G._hasSetupEvents&&p(G)}connectedCallback(){if(this._hydrate&&!this._hasRendered){this.model=x(this,!0);var G=this._hydrate(this.model),H=this.constructor.renderMode;'light'===H?this.appendChild(G):(this.attachShadow({mode:'open'}),this.shadowRoot.appendChild(G))}}}}function p(F){F._hasSetupEvents=!0,F.events().forEach(function(G){Object.defineProperty(F.prototype,'on'+G,{get:function(){return this['_on'+G]},set:function(H){var I='_on'+G,J=this[I];J&&this.removeEventListener(G,J),this[I]=H,this.addEventListener(G,H)}})})}var q='function'==typeof Symbol?Symbol:function(F){return'@@-'+F},r=Object.values||function(F){return Object.keys(F).reduce(function(G,H){return G.push(F[H]),G},[])},s=Array.prototype.forEach,t=Array.prototype.some,u=Array.prototype.slice,v=q('bram-events'),w=q('bram-array-change'),x=function(F,G){return F=d(F,G)||{},Object.defineProperty(F,v,{value:{},enumerable:!1}),c(F,function(H,I){var J=F[v][H.prop];J&&J.forEach(function(K){K(H,I)})})},y=function(F){return F&&!!F[v]},z=function(F,G,H){var I=F[v];if(I){var J=I[G];J||(J=I[G]=[]),J.push(H)}},A=function(F,G,H){var I=F[v];if(I){var J=I[G];if(J){var K=J.indexOf(H);-1===K||(J.splice(K,1),!J.length&&delete I[G])}}};e.prototype.read=function(F){return this._read(F)||{model:this.model,value:void 0}},e.prototype._read=function(F){var G=this.model[F];return null==G?this.parent?this.parent.read(F):void 0:{model:this.model,value:G}},e.prototype.add=function(F){var G;return G=y(F)?F:Array.isArray(F)||'object'==typeof F?x(F):F,new e(G,this)},g.prototype.getValue=function(F){var G=this.props()[0];return F.read(G).value},g.prototype.getStringValue=function(F){for(var I,J,G=Object.keys(this.values).sort(),H=this.raw;G.length;)I=G.pop(),J=F.read(this.values[I]).value,H=J?H.substr(0,I)+J+H.substr(I):void 0;return H},g.prototype.compute=function(F){var G=this.includesNonBindings||1<this.count();return G?this.getStringValue.bind(this,F):this.getValue.bind(this,F)},g.prototype.props=function(){return r(this.values)},g.prototype.count=function(){return!1===this.hasBinding?0:Object.keys(this.values).length},g.prototype.throwIfMultiple=function(F){if(1<this.count())throw F=F||'Only a single binding is allowed in this context.',new Error(F)};var B={attr:function(F,G){return function(H){F.setAttribute(G,H)}},text:function(F){return function(G){F.nodeValue=G}},prop:function(F,G){return function(H){F[G]=H}},event:function(F,G,H,I){var J=I.raw;F.addEventListener(G,function(K){var L=H.read(J);L.value.call(L.model,K)})},each:function(F,G,H){var I=D(F),J=H.props()[0],K=G.read(J),L=document.createTextNode('');F.parentNode.replaceChild(L,F);var M=function(O){var P=new Map,Q=new Map,R=function(U,V){var W=G.add(U).add({item:U,index:V}),X=I(W),Y={item:U,nodes:u.call(X.childNodes),scope:W,index:V};P.set(U,Y),Q.set(V,Y);var Z=Q.get(V+1),$=L.parentNode;if(Z){var _=Z.nodes[0];$.insertBefore(X,_)}else $.appendChild(X)},S=function(U){var V=Q.get(U);V&&(V.nodes.forEach(function(W){W.parentNode.removeChild(W)}),P.delete(V.item),Q.delete(U))};O.forEach(R);var T=function(U,V){if('delete'===U.type)return void S(U.index);var W=P.get(V);if(W){var X=W.index,Y=X!==U.index;if(Y){W.scope.model.index=W.index=U.index;var Z=Q.get(U.index);Z?Q.set(X,Z):Q.delete(X),Q.set(U.index,W);var $=Q.get(U.index+1);$&&($=$.nodes[0]);for(var _=W.nodes.length-1;0<=_;)L.parentNode.insertBefore(W.nodes[_],$),_--}}else S(U.index),R(V,U.index)};return z(O,w,T),function(){for(var U=0,V=O.length;U<V;U++)S(U);A(O,w,T),P=null,Q=null}},N=M(K.value);z(K.model,J,function(O,P){N(),N=M(P)})},if:function(F,G){var H=D(F),I=!1,J={},K=document.createTextNode('');return F.parentNode.replaceChild(K,F),function(L){if(!!I){var O=K.parentNode,P=K.nextSibling;L?J.children.forEach(function(Q){O.insertBefore(Q,P)}):J.children.forEach(function(Q){O.removeChild(Q)})}else if(L){var M=G.add(L),N=H(M);J.children=u.call(N.childNodes),J.scope=M,K.parentNode.insertBefore(N,K.nextSibling),I=!0}}}},C=['if','each'],D=function(F){F=F instanceof HTMLTemplateElement?F:document.querySelector(F);var G=k(F.content,{id:0},{});return function(H){H instanceof e||(H=new e(H));var I=document.importNode(F.content,!0);return f(I,G,H),I}},E=n(HTMLElement);return n.Element=E,n.model=x,n.template=D,n});

